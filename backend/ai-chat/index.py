import json

def handler(event: dict, context) -> dict:
    """AI —á–∞—Ç-–±–æ—Ç —Å —É–º–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã"""
    
    method = event.get('httpMethod', 'GET')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type',
                'Access-Control-Max-Age': '86400'
            },
            'body': ''
        }
    
    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({'error': 'Method not allowed'})
        }
    
    try:
        body_str = event.get('body', '{}')
        body = json.loads(body_str) if isinstance(body_str, str) else body_str
        user_message = body.get('message', '').strip()
        
        if not user_message:
            return {
                'statusCode': 400,
                'headers': {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                },
                'body': json.dumps({'error': '–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º'})
            }
        
        lower_msg = user_message.lower()
        reply = ''
        
        if '–æ–≤—Ü' in lower_msg or ('–ø—Ä–æ–¥–∞—Ç—å' in lower_msg and '–∂–∏–≤–æ—Ç–Ω' in lower_msg):
            reply = 'üêë –î–ª—è –ø—Ä–æ–¥–∞–∂–∏ –æ–≤—Ü—ã:\n\n1Ô∏è‚É£ –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–∞ –ê–≤–∏—Ç–æ, –Æ–ª–∞ –∏–ª–∏ –º–µ—Å—Ç–Ω—ã—Ö —Ñ–µ—Ä–º–µ—Ä—Å–∫–∏—Ö —Ñ–æ—Ä—É–º–∞—Ö\n2Ô∏è‚É£ –£–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ—Ä–æ–¥—É, –≤–µ—Å –∂–∏–≤–æ—Ç–Ω–æ–≥–æ\n3Ô∏è‚É£ –î–æ–±–∞–≤—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ\n4Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∞–¥–µ–∫–≤–∞—Ç–Ω—É—é —Ü–µ–Ω—É (3000-15000‚ÇΩ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Ä–æ–¥—ã)\n5Ô∏è‚É£ –û–ø–∏—à–∏—Ç–µ —É—Å–ª–æ–≤–∏—è —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏\n\nüí° –°–æ–≤–µ—Ç: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∂–µ–π!'
        
        elif '–≥–æ—Ä–æ–¥' in lower_msg and '–∏–≥—Ä' in lower_msg:
            reply = 'üéÆ –î–∞–≤–∞–π —Å—ã–≥—Ä–∞–µ–º –≤ –≥–æ—Ä–æ–¥–∞! –Ø –Ω–∞—á–Ω—É: –ú–æ—Å–∫–≤–∞. –¢–≤–æ–π —Ö–æ–¥ ‚Äî –≥–æ—Ä–æ–¥ –Ω–∞ –±—É–∫–≤—É "–ê"!'
        
        elif '–ø–æ–≥–æ–¥' in lower_msg:
            reply = 'üå§Ô∏è –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≥–æ–¥—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:\n‚Ä¢ Yandex.–ü–æ–≥–æ–¥–∞ ‚Äî —Ç–æ—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ –†–æ—Å—Å–∏–∏\n‚Ä¢ Gismeteo ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ–¥–µ–ª—é\n‚Ä¢ Windy ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ –ø–æ–≥–æ–¥—ã\n\n–ù–∞–¥–µ—é—Å—å, —É –≤–∞—Å —Å–µ–π—á–∞—Å —Ö–æ—Ä–æ—à–∞—è –ø–æ–≥–æ–¥–∞! ‚òÄÔ∏è'
        
        elif '–∫–∞–∫ –¥–µ–ª–∞' in lower_msg or '–ø—Ä–∏–≤–µ—Ç' in lower_msg:
            reply = 'üéÑ –ü—Ä–∏–≤–µ—Ç! –£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏. –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?'
        
        elif '—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å' in lower_msg or '—á—Ç–æ –º–æ–∂–µ—à—å' in lower_msg:
            reply = 'ü§ñ –Ø –º–æ–≥—É:\n\n‚úÖ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã\n‚úÖ –î–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –ø—Ä–æ–¥–∞—Ç—å –æ–≤—Ü—É)\n‚úÖ –ò–≥—Ä–∞—Ç—å –≤ —Å–ª–æ–≤–∞ –∏ –≥–æ—Ä–æ–¥–∞\n‚úÖ –†–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã\n‚úÖ –ü–æ–º–æ–≥–∞—Ç—å —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º\n\n–ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å!'
        
        elif '–Ω–æ–≤—ã–π –≥–æ–¥' in lower_msg or '–Ω–æ–≤–æ–≥–æ–¥–Ω' in lower_msg:
            reply = 'üéâ –° –Ω–∞—Å—Ç—É–ø–∞—é—â–∏–º –ù–æ–≤—ã–º –ì–æ–¥–æ–º! –ü—É—Å—Ç—å 2025 –≥–æ–¥ –ø—Ä–∏–Ω–µ—Å—ë—Ç:\n\nüéÅ –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∂–µ–ª–∞–Ω–∏–π\nüíö –ö—Ä–µ–ø–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ\nüåü –£—Å–ø–µ—Ö –≤ –¥–µ–ª–∞—Ö\n‚ù§Ô∏è –°—á–∞—Å—Ç—å–µ –≤ —Å–µ–º—å–µ\n\n–ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –≤–æ–ª—à–µ–±–Ω—ã–º! ‚ú®'
        
        elif '–∫—Ç–æ —Ç—ã' in lower_msg or '–∫—Ç–æ —Å–æ–∑–¥–∞–ª' in lower_msg:
            reply = 'ü§ñ –Ø MegaChat.BETA ‚Äî AI-–ø–æ–º–æ—â–Ω–∏–∫, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –°—Ç–µ–ø–∞–Ω–æ–º –ü–µ—Ç—Ä–æ–≤—ã–º.\n\n–ú–æ–π —Å–æ–∑–¥–∞—Ç–µ–ª—å:\nüë®‚Äçüíª –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç\nüé§ –ü–µ–≤–µ—Ü\nüìπ –ë–ª–æ–≥–µ—Ä\nüéÆ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç–µ—Ä\nüòÅ –ü—Ä–æ—Å—Ç–æ –¥—É—à–∫–∞!\n\n–ó–∞–¥–∞–≤–∞–π –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã!'
        
        elif '–ø—Ä–∞–≤–∏–ª–∞' in lower_msg or '—Å–æ–≥–ª–∞—à–µ–Ω–∏–µ' in lower_msg:
            reply = 'üìú –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:\n\n‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ:\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ç –∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è\n‚Ä¢ –í—ã–¥–∞–≤–∞—Ç—å —Å–µ–±—è –∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é\n‚Ä¢ –°–ø–∞–º –∏ —Ä–µ–∫–ª–∞–º–∞\n\n‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ:\n‚Ä¢ –ó–∞–¥–∞–≤–∞—Ç—å –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã\n‚Ä¢ –û—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç–∑—ã–≤—ã\n‚Ä¢ –û–±—â–∞—Ç—å—Å—è –≤–µ–∂–ª–∏–≤–æ\n\nüìß –°–≤—è–∑—å: MegaSchoolChat@gmail.com'
        
        elif '–∫–æ–Ω—Ç–∞–∫—Ç' in lower_msg or '–ø–æ—á—Ç–∞' in lower_msg or 'email' in lower_msg:
            reply = 'üìß –ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã:\n\nEmail: MegaSchoolChat@gmail.com\n\nüåê –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:\n‚Ä¢ –ò–Ω—Ñ–æ-–ø–æ—Ä—Ç–∞–ª: https://megachat-info-portal--preview.poehali.dev/\n‚Ä¢ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç: https://ai-school-tools--preview.poehali.dev/\n\n–ü–∏—à–∏—Ç–µ, –±—É–¥–µ–º —Ä–∞–¥—ã –ø–æ–º–æ—á—å!'
        
        elif '–ø–æ–º–æ—â—å' in lower_msg or 'help' in lower_msg:
            reply = 'üí° –í–æ—Ç —á—Ç–æ —è —É–º–µ—é:\n\nüîπ –î–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–∫–∞–∫ –ø—Ä–æ–¥–∞—Ç—å –æ–≤—Ü—É")\nüîπ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –ù–æ–≤—ã–π –ì–æ–¥\nüîπ –ò–≥—Ä–∞—Ç—å –≤ –≥–æ—Ä–æ–¥–∞\nüîπ –†–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ –ø—Ä–∞–≤–∏–ª–∞ —Å–∞–π—Ç–∞\nüîπ –î–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏\n\n–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å!'
        
        elif '—Å–ø–∞—Å–∏–±–æ' in lower_msg or '–±–ª–∞–≥–æ–¥–∞—Ä' in lower_msg:
            reply = 'üåü –í—Å–µ–≥–¥–∞ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞! –†–∞–¥ –ø–æ–º–æ—á—å! –ï—Å–ª–∏ –±—É–¥—É—Ç –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã ‚Äî –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å! üòä'
        
        elif '–ø–æ–∫–∞' in lower_msg or '–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è' in lower_msg:
            reply = 'üëã –î–æ –≤—Å—Ç—Ä–µ—á–∏! –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å, –∫–æ–≥–¥–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–º–æ—â—å! –£–¥–∞—á–∏! üçÄ'
        
        else:
            reply = f'üéÑ –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –Ø –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –æ—Ç–≤–µ—Ç–∏—Ç—å:\n\nüí≠ "{user_message}"\n\nüìå –ú–æ–≥—É –ø–æ—Å–æ–≤–µ—Ç–æ–≤–∞—Ç—å:\n‚Ä¢ –£—Ç–æ—á–Ω–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ\n‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ø—Ä–æ—Å–∏—Ç—å: "–ö–∞–∫ –ø—Ä–æ–¥–∞—Ç—å –æ–≤—Ü—É?", "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –ù–æ–≤—ã–π –ì–æ–¥"\n‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ "–ø–æ–º–æ—â—å" —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –º–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n\n‚ú® –ó–∞–¥–∞–≤–∞–π—Ç–µ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã!'
        
        return {
            'statusCode': 200,
            'headers': {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({
                'reply': reply,
                'timestamp': body.get('timestamp', '')
            })
        }
            
    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({
                'error': '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞',
                'details': str(e)
            })
        }
